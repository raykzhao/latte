#include <stdint.h>
#include "ntt.h"
#include "param.h"
#include "poly.h"
#include "red.h"

static const uint64_t inv_n = 16744465;

static const uint64_t root[N] = {0, 1988315, 14899773, 14719561, 11930405, 6701080, 659558, 15369345, 7354801, 10601440, 6817155, 9456454, 2251032, 1607954, 11631221, 12162530, 13656077, 3034156, 5074216, 16218269, 5884202, 12000572, 15661010, 13663885, 14581557, 13372875, 5999281, 14494886, 9421437, 4800883, 365533, 1716427, 15143689, 12603334, 9708390, 10520236, 10292427, 6687441, 10542897, 2780107, 16230403, 12145222, 12272246, 12166036, 15397972, 3528970, 14433026, 12854798, 2467394, 10658353, 15959095, 8408153, 10227554, 8322864, 9196288, 16321765, 2077553, 7467917, 3423584, 8507638, 14592207, 14963320, 16236338, 480588, 11084477, 7565734, 6234516, 1741833, 11070395, 15188767, 13831345, 10763466, 4616254, 13029343, 15211135, 5300945, 8404905, 15928658, 6830872, 11418359, 15808910, 2465312, 4026606, 11247761, 2127785, 12797615, 2955111, 6920206, 6900376, 10136154, 6855990, 11596923, 13016815, 15419962, 10038424, 2898565, 1677290, 4184707, 681008, 16448023, 1295043, 13679938, 10433796, 10589780, 10897916, 1447039, 8788236, 16494430, 3452841, 514709, 962468, 3948848, 10211558, 15282356, 14490637, 4831223, 5081327, 810526, 5826375, 3608766, 8062322, 11029622, 4260408, 11650029, 11811912, 7804512, 12659254, 9023828, 1805814, 11559026, 5406986, 9807817, 4744425, 15070890, 16272388, 3660905, 2716491, 12361122, 10574562, 1489145, 11073942, 5480982, 15803946, 5438138, 5382129, 12005304, 8523232, 3296052, 4088224, 8300006, 11613082, 9823536, 15068546, 9557486, 14747211, 5439418, 5455979, 5014020, 14276296, 5895198, 5283833, 4707081, 1437255, 404379, 12254855, 1802267, 1627688, 3434385, 2998434, 11194524, 9639811, 10012689, 15039703, 5714410, 2047515, 5846408, 12239925, 7677661, 2652484, 10128452, 13732767, 2053935, 12439773, 13962880, 648389, 13677787, 9973426, 698887, 11840270, 2801296, 3040721, 12780331, 2803594, 14281541, 3827930, 6192003, 11000366, 7067881, 11186136, 16003563, 7174960, 14220812, 5160037, 2807405, 2132971, 2020482, 13064280, 16173776, 12342105, 13730318, 9559428, 1069504, 14779264, 7873323, 9620584, 2585262, 16055972, 11457702, 1588325, 4000669, 4930742, 6060528, 4633150, 10217412, 7192175, 8725999, 1980121, 15548719, 14573166, 10963050, 7201666, 1306547, 15380045, 5817094, 1817045, 3219081, 5203054, 1984169, 15055869, 5311522, 7939598, 586993, 4480026, 12389201, 768179, 878084, 9586976, 14122566, 12533089, 10602543, 4777929, 15494575, 8170148, 4327918, 16698304, 4094345, 13476151, 3375226, 9182013, 4078389, 4735967, 3767031, 15117363, 5665940, 4891672, 2743969, 332172, 16272944, 6248582, 14009080, 10913379, 11790429, 8650227, 9080708, 12965412, 15998077, 1855481, 6928834, 3820988, 4258243, 9304053, 10028005, 10108964, 4304871, 13335941, 8482784, 7299100, 7500293, 9226256, 4398251, 7821821, 16685377, 9263932, 14289656, 6102407, 1032215, 5669438, 10947585, 3517732, 10024387, 14326755, 5585293, 14784048, 10775318, 6748359, 2157085, 13064874, 15223783, 1688983, 8142082, 16095881, 2568933, 8863559, 13665457, 15749966, 16655789, 10938255, 11114484, 1953207, 2102463, 8517732, 2159938, 11361233, 10038995, 11012165, 13338815, 8566576, 6605627, 3012998, 7766794, 11747571, 1760612, 10731118, 6864711, 771, 5285030, 7866303, 13208759, 2494575, 2260972, 1765279, 10895849, 3844741, 101770, 16133232, 5841242, 8746363, 3072618, 9593181, 2026117, 15820947, 14563325, 3034033, 13544203, 1884019, 12811630, 9326732, 139937, 7056936, 10539150, 9767431, 1451184, 14132462, 7487099, 8738105, 11313587, 1966956, 14566307, 4229658, 6821831, 14285384, 5017600, 14632574, 6583608, 15389729, 1503218, 9550357, 5954929, 10769524, 14347073, 10698709, 11207878, 420141, 14325270, 14955863, 11922016, 12281582, 4684092, 7062087, 1369922, 2763581, 1609633, 10713148, 3945047, 2132335, 4899961, 9875634, 3768498, 13818372, 5749356, 15719381, 16219491, 6716433, 1071996, 12827796, 14473926, 13663454, 8928001, 6260398, 7527008, 7140836, 13547159, 14775843, 11792650, 1074207, 1852528, 15782361, 12955784, 10251877, 16290985, 12029333, 16092394, 11220470, 7029786, 13306422, 6962388, 12841356, 2098791, 10635167, 9162684, 8380812, 6971923, 14176461, 9438737, 13573094, 8181535, 1438143, 2708817, 678762, 9486967, 7558477, 1452908, 10823566, 9858752, 8279704, 9137146, 6452634, 6742292, 6401995, 12927018, 13547036, 3298611, 2353323, 12138874, 15939521, 4949932, 987546, 3570613, 5322557, 2369287, 2900989, 10294929, 4978674, 4515533, 6296000, 14527676, 11998684, 11413051, 8310486, 7706450, 14829590, 13673457, 5522700, 2285378, 8598633, 4066962, 14330054, 2481854, 2026833, 5401771, 16754507, 3288778, 7066702, 4852587, 16599921, 12764938, 184707, 14670769, 12973448, 15561415, 1391449, 7240033, 10903538, 1767265, 13975066, 7179587, 2059536, 4313035, 14658395, 12776727, 13333762, 10415762, 8180620, 9306899, 8774993, 11912135, 11296647, 15250430, 14774022, 4462271, 4295408, 12784997, 14502737, 14035007, 9994979, 16200968, 10500559, 5931652, 224072, 11618200, 9962677, 13234135, 6211435, 8548196, 345646, 10243066, 8777160, 8136034, 4689906, 767779, 9744776, 15025498, 1678036, 15407050, 14170939, 2130092, 4035606, 2440872, 14185231, 1620462, 8509566, 13357628, 3219137, 12371140, 7667394, 4490626, 12366689, 7313657, 6975229, 4955001, 11626389, 1888043, 14284534, 5756246, 14188482, 7905364, 5087989, 15607526, 3577381, 16123013, 15406160, 15264644, 3336262, 2281682, 9168627, 1276725, 4190760, 7575591, 12342572, 11431509, 6478316, 9743472, 9396730, 4896158, 7860918, 11578338, 10902300, 15541877, 10191467, 9236737, 15768022, 13230196, 15560469, 6541880, 11794109, 6790463, 7408181, 7792637, 5201205, 12700947, 12288650, 829394, 15913639, 15925590, 12563772, 6536707, 11982520, 9329654, 652338, 7051707, 7362013, 12103385, 9660818, 315589, 3685052, 9358817, 2078454, 1991919, 9802137, 16092554, 11730033, 14910877, 14681482, 15272342, 7111081, 3713399, 10641924, 14806561, 14477648, 2946560, 16648366, 2019078, 631469, 12803472, 10068071, 12905051, 6126079, 5385703, 5442870, 1458960, 12079891, 1656796, 4564326, 4204367, 2535542, 2233245, 2950789, 16315531, 15076838, 9332171, 9310670, 5342669, 3024533, 7010688, 7558743, 5993663, 670224, 13830343, 7632006, 16391624, 7783790, 3947485, 15639828, 14639677, 7185752, 6893352, 4669509, 6385439, 14788877, 16398816, 5096385, 3421222, 1049952, 9915715, 8719852, 16606174, 15404845, 15815814, 10605328, 3187896, 14921719, 2589547, 179523, 6200784, 5477918, 9966420, 12827645, 9438864, 10101617, 11399250, 8778281, 14102847, 8158862, 5616952, 11439783, 9808678, 2673284, 14729771, 16391465, 14038905, 5857885, 2255312, 4233636, 6046701, 12660690, 519496, 9917784, 16436914, 6412230, 2455361, 7194658, 14376860, 11044424, 11097860, 906877, 14949523, 6551036, 16354074, 9571247, 15999254, 5810582, 1242409, 14643144, 7060455, 13305824, 12884951, 416436, 2558741, 4176335, 14195260, 10557938, 1382976, 3064001, 1620689, 5991206, 4751190, 7932311, 136154, 1417973, 2686874, 15961364, 11918181, 4756457, 8243366, 15596943, 2215600, 13520080, 8542674, 6332873, 8632112, 16175883, 7465670, 12713976, 14001090, 6066673, 7278860, 7539137, 8794336, 10446926, 13180097, 3606825, 1933682, 13011585, 13852033, 4885309, 10126937, 5583665, 14970108, 9780153, 8418651, 11244404, 4135766, 15670982, 3302462, 10798490, 7750702, 16228042, 5678473, 12837130, 9478267, 10618099, 7904296, 1135523, 5595482, 13816746, 15799101, 3990118, 16217203, 4457932, 7374309, 8147360, 7251438, 8410292, 15072794, 8431801, 1468980, 12564712, 11241067, 13261660, 6541413, 5143331, 4073923, 1278842, 15690731, 3011617, 6561204, 2107673, 7716739, 16275869, 8957193, 15729093, 10619291, 710583, 15395771, 13011248, 5389814, 7036943, 16752230, 8598822, 12145108, 9185547, 2151040, 4909014, 15358805, 369971, 15724902, 16178064, 3046407, 14654605, 14492729, 12455740, 1152438, 14501341, 6335305, 11013479, 5650371, 2266006, 8077622, 271992, 8230082, 11421370, 12874069, 8400511, 14265245, 8077729, 7184827, 16577796, 4385381, 13973690, 8138701, 620468, 3393970, 7700278, 4664343, 8268578, 12653376, 11738268, 10120936, 15003754, 2682948, 1991389, 3114584, 8153095, 9563642, 13820627, 9902546, 7291979, 1817795, 8340653, 8190490, 8119387, 11328532, 16565435, 9566379, 460351, 8369351, 15093818, 2661268, 322153, 9638316, 2951189, 5122688, 7860729, 3500192, 14756822, 16451196, 8549328, 11222060, 11855355, 13749227, 9482707, 15445893, 4523534, 12953402, 15040013, 5839394, 3698952, 10096890, 9416668, 8393000, 425692, 10724032, 849194, 11914360, 10526117, 12235005, 13647677, 3432197, 1957347, 1068244, 700044, 1522756, 14544423, 131555, 11592592, 5347201, 7820426, 16122949, 5225953, 3538912, 3984404, 12940256, 8399172, 11130169, 4242686, 2126019, 11589143, 10552852, 10046462, 16736451, 11108391, 12773731, 11113280, 10852011, 2755119, 12039177, 11331432, 7107291, 10059199, 13437197, 7415366, 957347, 12482167, 8238687, 3733311, 11946633, 10905215, 3741001, 8689133, 15142641, 16589333, 1142990, 10390937, 16126497, 44321, 3919745, 13945408, 2467252, 8106199, 13797148, 11839559, 6731881, 14164458, 5356378, 13267617, 1049310, 11545422, 14985092, 4704104, 16548546, 367687, 5720762, 10544583, 1945977, 9506383, 14826811, 8783227, 16745753, 13438091, 1547217, 5395475, 14250169, 1918488, 12002362, 3553361, 8601457, 15879585, 12036127, 13140960, 10864147, 15715860, 10366404, 7910103, 2752843, 9351641, 342372, 16425272, 14909155, 6613770, 447595, 6577300, 16562138, 15666365, 2306082, 788420, 4821491, 891786, 11460447, 6664083, 14028165, 15889175, 7251815, 2592351, 2320808, 1800788, 7802522, 3178908, 44684, 6146695, 4073580, 6810855, 13945193, 4019863, 4960722, 16123519, 4304168, 14899566, 12257147, 10988459, 969673, 2291693, 13243506, 6619690, 15810515};
static const uint64_t root_inv[N] = {0, 16655655, 2041272, 1861060, 1391488, 16101275, 10059753, 4830428, 4598303, 5129612, 15152879, 14509801, 7304379, 9943678, 6159393, 9406032, 15044406, 16395300, 11959950, 7339396, 2265947, 10761552, 3387958, 2179276, 3096948, 1099823, 4760261, 10876631, 542564, 11686617, 13726677, 3104756, 16280245, 524495, 1797513, 2168626, 8253195, 13337249, 9292916, 14683280, 439068, 7564545, 8437969, 6533279, 8352680, 801738, 6102480, 14293439, 3906035, 2327807, 13231863, 1362861, 4594797, 4488587, 4615611, 530430, 13980726, 6217936, 10073392, 6468406, 6240597, 7052443, 4157499, 1617144, 7737005, 4101579, 8956321, 4948921, 5110804, 12500425, 5731211, 8698511, 13152067, 10934458, 15950307, 11679506, 11929610, 2270196, 1478477, 6549275, 12811985, 15798365, 16246124, 13307992, 266403, 7972597, 15313794, 5862917, 6171053, 6327037, 3080895, 15465790, 312810, 16079825, 12576126, 15083543, 13862268, 6722409, 1340871, 3744018, 5163910, 9904843, 6624679, 9860457, 9840627, 13805722, 3963218, 14633048, 5513072, 12734227, 14295521, 951923, 5342474, 9929961, 832175, 8355928, 11459888, 1549698, 3731490, 12144579, 5997367, 2929488, 1572066, 5690438, 15019000, 10526317, 9195099, 5676356, 12666488, 62529, 12432915, 8590685, 1266258, 11982904, 6158290, 4227744, 2638267, 7173857, 15882749, 15992654, 4371632, 12280807, 16173840, 8821235, 11449311, 1704964, 14776664, 11557779, 13541752, 14943788, 10943739, 1380788, 15454286, 9559167, 5797783, 2187667, 1212114, 14780712, 8034834, 9568658, 6543421, 12127683, 10700305, 11830091, 12760164, 15172508, 5303131, 704861, 14175571, 7140249, 8887510, 1981569, 15691329, 7201405, 3030515, 4418728, 587057, 3696553, 14740351, 14627862, 13953428, 11600796, 2540021, 9585873, 757270, 5574697, 9692952, 5760467, 10568830, 12932903, 2479292, 13957239, 3980502, 13720112, 13959537, 4920563, 16061946, 6787407, 3083046, 16112444, 2797953, 4321060, 14706898, 3028066, 6632381, 14108349, 9083172, 4520908, 10914425, 14713318, 11046423, 1721130, 6748144, 7121022, 5566309, 13762399, 13326448, 15133145, 14958566, 4505978, 16356454, 15323578, 12053752, 11477000, 10865635, 2484537, 11746813, 11304854, 11321415, 2013622, 7203347, 1692287, 6937297, 5147751, 8460827, 12672609, 13464781, 8237601, 4755529, 11378704, 11322695, 956887, 11279851, 5686891, 15271688, 6186271, 4399711, 14044342, 13099928, 488445, 1689943, 12016408, 6953016, 11353847, 5201807, 14955019, 3975836, 12465425, 12298562, 1986811, 1510403, 5464186, 4848698, 7985840, 7453934, 8580213, 6345071, 3427071, 3984106, 2102438, 12447798, 14701297, 9581246, 2785767, 14993568, 5857295, 9520800, 15369384, 1199418, 3787385, 2090064, 16576126, 3995895, 160912, 11908246, 9694131, 13472055, 6326, 11359062, 14734000, 14278979, 2430779, 12693871, 8162200, 14475455, 11238133, 3087376, 1931243, 9054383, 8450347, 5347782, 4762149, 2233157, 10464833, 12245300, 11782159, 6465904, 13859844, 14391546, 11438276, 13190220, 15773287, 11810901, 821312, 4621959, 14407510, 13462222, 3213797, 3833815, 10358838, 10018541, 10308199, 7623687, 8481129, 6902081, 5937267, 15307925, 9202356, 7273866, 16082071, 14052016, 15322690, 8579298, 3187739, 7322096, 2584372, 9788910, 8380021, 7598149, 6125666, 14662042, 3919477, 9798445, 3454411, 9731047, 5540363, 668439, 4731500, 469848, 6508956, 3805049, 978472, 14908305, 15686626, 4968183, 1984990, 3213674, 9619997, 9233825, 10500435, 7832832, 3097379, 2286907, 3933037, 15688837, 10044400, 541342, 1041452, 11011477, 2942461, 12992335, 6885199, 11860872, 14628498, 12815786, 6047685, 15151200, 13997252, 15390911, 9698746, 12076741, 4479251, 4838817, 1804970, 2435563, 16340692, 5552955, 6062124, 2413760, 5991309, 10805904, 7210476, 15257615, 1371104, 10177225, 2128259, 11743233, 2475449, 9939002, 12531175, 2194526, 14793877, 5447246, 8022728, 9273734, 2628371, 15309649, 6993402, 6221683, 9703897, 16620896, 7434101, 3949203, 14876814, 3216630, 13726800, 2197508, 939886, 14734716, 7167652, 13688215, 8014470, 10919591, 627601, 16659063, 12916092, 5864984, 14995554, 14499861, 14266258, 3552074, 8894530, 11475803, 16760062, 9896122, 6029715, 15000221, 5013262, 8994039, 13747835, 10155206, 8194257, 3422018, 5748668, 6721838, 5399600, 14600895, 8243101, 14658370, 14807626, 5646349, 5822578, 105044, 1010867, 3095376, 7897274, 14191900, 664952, 8618751, 15071850, 1537050, 3695959, 14603748, 10012474, 5985515, 1976785, 11175540, 2434078, 6736446, 13243101, 5813248, 11091395, 15728618, 10658426, 2471177, 7496901, 75456, 8939012, 12362582, 7534577, 9260540, 9461733, 8278049, 3424892, 12455962, 6651869, 6732828, 7456780, 12502590, 12939845, 9831999, 14905352, 762756, 3795421, 7680125, 8110606, 4970404, 5847454, 2751753, 10512251, 487889, 16428661, 14016864, 11869161, 11094893, 1643470, 12993802, 12024866, 12682444, 7578820, 13385607, 3284682, 950318, 10141143, 3517327, 14469140, 15791160, 5772374, 4503686, 1861267, 12456665, 637314, 11800111, 12740970, 2815640, 9949978, 12687253, 10614138, 16716149, 13581925, 8958311, 14960045, 14440025, 14168482, 9509018, 871658, 2732668, 10096750, 5300386, 15869047, 11939342, 15972413, 14454751, 1094468, 198695, 10183533, 16313238, 10147063, 1851678, 335561, 16418461, 7409192, 14007990, 8850730, 6394429, 1044973, 5896686, 3619873, 4724706, 881248, 8159376, 13207472, 4758471, 14842345, 2510664, 11365358, 15213616, 3322742, 15080, 7977606, 1934022, 7254450, 14814856, 6216250, 11040071, 16393146, 212287, 12056729, 1775741, 5215411, 15711523, 3493216, 11404455, 2596375, 10028952, 4921274, 2963685, 8654634, 14293581, 2815425, 12841088, 16716512, 634336, 6369896, 15617843, 171500, 1618192, 8071700, 13019832, 5855618, 4814200, 13027522, 8522146, 4278666, 15803486, 9345467, 3323636, 6701634, 9653542, 5429401, 4721656, 14005714, 5908822, 5647553, 3987102, 5652442, 24382, 6714371, 6207981, 5171690, 14634814, 12518147, 5630664, 8361661, 3820577, 12776429, 13221921, 11534880, 637884, 8940407, 11413632, 5168241, 16629278, 2216410, 15238077, 16060789, 15692589, 14803486, 13328636, 3113156, 4525828, 6234716, 4846473, 15911639, 6036801, 16335141, 8367833, 7344165, 6663943, 13061881, 10921439, 1720820, 3807431, 12237299, 1314940, 7278126, 3011606, 4905478, 5538773, 8211505, 309637, 2004011, 13260641, 8900104, 11638145, 13809644, 7122517, 16438680, 14099565, 1667015, 8391482, 16300482, 7194454, 195398, 5432301, 8641446, 8570343, 8420180, 14943038, 9468854, 6858287, 2940206, 7197191, 8607738, 13646249, 14769444, 14077885, 1757079, 6639897, 5022565, 4107457, 8492255, 12096490, 9060555, 13366863, 16140365, 8622132, 2787143, 12375452, 183037, 9576006, 8683104, 2495588, 8360322, 3886764, 5339463, 8530751, 16488841, 8683211, 14494827, 11110462, 5747354, 10425528, 2259492, 15608395, 4305093, 2268104, 2106228, 13714426, 582769, 1035931, 16390862, 1402028, 11851819, 14609793, 7575286, 4615725, 8162011, 8603, 9723890, 11371019, 3749585, 1365062, 16050250, 6141542, 1031740, 7803640, 484964, 9044094, 14653160, 10199629, 13749216, 1070102, 15481991, 12686910, 11617502, 10219420, 3499173, 5519766, 4196121, 15291853, 8329032, 1688039, 8350541, 9509395, 8613473, 9386524, 12302901, 543630, 12770715, 961732, 2944087, 11165351, 15625310, 8856537, 6142734, 7282566, 3923703, 11082360, 532791, 9010131, 5962343, 13458371, 1089851, 12625067, 5516429, 8342182, 6980680, 1790725, 11177168, 6633896, 11875524, 2908800, 3749248, 14827151, 13154008, 3580736, 6313907, 7966497, 9221696, 9481973, 10694160, 2759743, 4046857, 9295163, 584950, 8128721, 10427960, 8218159, 3240753, 14545233, 1163890, 8517467, 12004376, 4842652, 799469, 14073959, 15342860, 16624679, 8828522, 12009643, 10769627, 15140144, 13696832, 15377857, 6202895, 2565573, 12584498, 14202092, 16344397, 3875882, 3455009, 9700378, 2117689, 15518424, 10950251, 761579, 7189586, 406759, 10209797, 1811310, 15853956, 5662973, 5716409, 2383973, 9566175, 14305472, 10348603, 323919, 6843049, 16241337, 4100143, 10714132, 12527197, 14505521, 10902948, 2721928, 369368, 2031062, 14087549, 6952155, 5321050, 11143881, 8601971, 2657986, 7982552, 5361583, 6659216, 7321969, 3933188, 6794413, 11282915, 10560049, 16581310, 14171286, 1839114, 13572937, 6155505, 945019, 1355988, 154659, 8040981, 6845118, 15710881, 13339611, 11664448, 362017, 1971956, 10375394, 12091324, 9867481, 9575081, 2121156, 1121005, 12813348, 8977043, 369209, 9128827, 2930490, 16090609, 10767170, 9202090, 9750145, 13736300, 11418164, 7450163, 7428662, 1683995, 445302, 13810044, 14527588, 14225291, 12556466, 12196507, 15104037, 4680942, 15301873, 11317963, 11375130, 10634754, 3855782, 6692762, 3957361, 16129364, 14741755, 112467, 13814273, 2283185, 1954272, 6118909, 13047434, 9649752, 1488491, 2079351, 1849956, 5030800, 668279, 6958696, 14768914, 14682379, 7402016, 13075781, 16445244, 7100015, 4657448, 9398820, 9709126, 16108495, 7431179, 4778313, 10224126, 4197061, 835243, 847194, 15931439, 4472183, 4059886, 11559628, 8968196, 9352652, 9970370, 4966724, 10218953, 1200364, 3530637, 992811, 7524096, 6569366, 1218956, 5858533, 5182495, 8899915, 11864675, 7364103, 7017361, 10282517, 5329324, 4418261, 9185242, 12570073, 15484108, 7592206, 14479151, 13424571, 1496189, 1354673, 637820, 13183452, 1153307, 11672844, 8855469, 2572351, 11004587, 2476299, 14872790, 5134444, 11805832, 9785604, 9447176, 4394144, 12270207, 9093439, 4389693, 13541696, 3403205, 8251267, 15140371, 2575602, 14319961, 12725227, 14630741, 2589894, 1353783, 15082797, 1735335, 7016057, 15993054, 12070927, 8624799, 7983673, 6517767, 16415187, 8212637, 10549398, 3526698, 6798156, 5142633, 16536761, 10829181, 6260274, 559865, 6765854, 2725826, 2258096};

/* Cooley-Tukey NTT */
void ntt(POLY_64 *a)
{
	uint64_t t = N >> 1;
	uint64_t m, i, j;
	uint64_t j1, j2;
	
	uint64_t x, u;
	
	for (j = 0; j < t; j++)
	{
		x = montgomery(con_add(a->poly[j], Q), MONTGOMERY_CONVERT_FACTOR);
		u = montgomery(con_add(a->poly[j + t], Q), root[1]);
		a->poly[j] = con_sub(x + u, Q);
		a->poly[j + t] = con_add(x - u, Q);
	}
	
	for (m = 2; m < (N >> 1); m <<= 1)
	{
		t >>= 1;
		for (i = 0; i < m; i++)
		{
			j1 = (i * t) << 1;
			j2 = j1 + t - 1;
			
			for (j = j1; j <= j2; j++)
			{
				x = a->poly[j];
				u = montgomery(a->poly[j + t], root[m + i]);
				a->poly[j] = con_sub(x + u, Q);
				a->poly[j + t] = con_add(x - u, Q);
			}
		}
	}

	for (i = 0; i < m; i++)
	{
		j = i << 1;
		
		x = a->poly[j];
		u = montgomery(a->poly[j + 1], root[m + i]);
		a->poly[j] = con_sub(x + u, Q);
		a->poly[j + 1] = con_add(x - u, Q);
	}
}

/* Gentleman-Sande INTT */
void intt(POLY_64 *a)
{
	uint64_t t = 2;
	uint64_t m, i, j;
	uint64_t j1, j2;
	uint64_t h = N >> 1;

	uint64_t x, y;
	
	for (i = 0; i < h; i++)
	{
		j = i << 1;
		
		x = con_sub(a->poly[j] + a->poly[j + 1], Q);
		y = con_add(a->poly[j] - a->poly[j + 1], Q);
		a->poly[j] = x;
		a->poly[j + 1] = montgomery(y, root_inv[h + i]);
	}
	
	for (m = N >> 1; m > 2; m >>= 1)
	{
		j1 = 0;
		h >>= 1;

		for (i = 0; i < h; i++)
		{
			j2 = j1 + t - 1;
			
			for (j = j1; j <= j2; j++)
			{
				x = con_sub(a->poly[j] + a->poly[j + t], Q);
				y = con_add(a->poly[j] - a->poly[j + t], Q);
				a->poly[j] = x;
				a->poly[j + t] = montgomery(y, root_inv[h + i]);
			}
			j1 += t << 1;
		}
		t <<= 1;
	}

	for (j = 0; j < t; j++)
	{
		x = con_sub(a->poly[j] + a->poly[j + t], Q);
		y = con_add(a->poly[j] - a->poly[j + t], Q);
		a->poly[j] = montgomery(x, inv_n);
		a->poly[j + t] = montgomery(y, root_inv[1]);
	}
}
